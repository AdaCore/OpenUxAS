dist: trusty
sudo: false

os:
  - linux
  - osx

language:
  - cpp

addons:
  apt:
    packages:
      - libglu1-mesa-dev
      - uuid-dev
      - libboost-date-time-dev
      - libboost-filesystem-dev
      - libboost-regex-dev
      - libboost-system-dev
      - libgtest-dev
      - ant
      - oracle-java8-set-default

before_install:
  # Homebrew deps for Mac
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew bundle --file=./.Brewfile; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then export BOOST_ROOT=/usr/local; fi
  - mkdir -p ~/.local/bin
  - export PATH=~/.local/bin:$PATH
  # install verion of Meson that is compatible with UxAS build
  - curl -L -s https://github.com/mesonbuild/meson/archive/0.44.0.zip -o meson.zip
  - unzip meson.zip
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then export PATH=~/Library/Python/3.6/bin:$PATH; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then cd meson-0.44.0; python3 setup.py install; cd ..; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then cd meson-0.44.0; python3 setup.py install --user; cd ..; fi
  - meson --version
  # download newer Ninja than is packaged in repos
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then curl -L -s https://github.com/ninja-build/ninja/releases/download/v1.7.2/ninja-mac.zip -o ninja.zip; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then curl -L -s https://github.com/ninja-build/ninja/releases/download/v1.7.2/ninja-linux.zip -o ninja.zip; fi
  - unzip ninja.zip
  - mv ninja ~/.local/bin
  - ninja --version

install:
  # clone, build, and run LmcpGen
  - git clone https://github.com/afrl-rq/LmcpGen.git ../LmcpGen
  # tries to check out the same branch as the one we're building if it's
  # available, so that development can proceed in tandem
  # - (cd ../LmcpGen; (git checkout $TRAVIS_BRANCH || true); ant jar)
  - cd ../LmcpGen; ant jar; cd ../OpenUxAS
  - sh RunLmcpGen.sh
  # process the wraps and their patches
  - ./prepare

before_script:
  - meson build

script:
  # build with -j2; Travis has 2 "cores"
  - ninja -C build test -j2
